{% extends "core/base.html" %}

{% block title %}Set New Password{% endblock %}

{% block content %}
<div class="container d-flex justify-content-center align-items-center" style="min-height: 80vh;">
    <div class="card shadow p-4 text-center" style="width: 350px;">
        <h3>Set a New Password</h3>

        {% if validlink %}
            <form method="POST" onsubmit="return validatePassword()">
                {% csrf_token %}
                <div class="mb-3">
                    <label for="new_password1" class="form-label">New Password</label>
                    <input type="password" id="new_password1" name="new_password1" class="form-control" required>
                </div>

                <div class="mb-3">
                    <label for="new_password2" class="form-label">Confirm New Password</label>
                    <input type="password" id="new_password2" name="new_password2" class="form-control" required>
                    <div id="password-error" class="text-danger" style="display: none;">Passwords do not match.</div>
                </div>

                <button type="submit" class="btn btn-success w-100">Change Password</button>
            </form>
        {% else %}
            <p class="text-danger">Invalid or expired reset link.</p>
        {% endif %}
    </div>
</div>

<script>
    function validatePassword() {
        var password1 = document.getElementById("new_password1").value;
        var password2 = document.getElementById("new_password2").value;
        var errorDiv = document.getElementById("password-error");

        if (password1 !== password2) {
            errorDiv.style.display = "block";
            return false;
        }
        errorDiv.style.display = "none";
        return true;
    }
</script>

{% if messages %}
<script>
    setTimeout(() => {
        window.location.href = "{% url 'login' %}";
    }, 3000); // Redirects in 3 seconds after success message
</script>
{% endif %}

{% endblock %}
